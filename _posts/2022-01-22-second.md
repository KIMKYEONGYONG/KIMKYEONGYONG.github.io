---
layout: post
title: "오일석의 Computuer Vision"
categories:
  - jekyll
  - blog
tags:
  [
    blog,
    jekyll,
    blog,
    jekyll theme,
    NexT theme,
    지킬 테마,
    지킬 블로그 포스팅,
    GitHub Pages,
  ]
---

# Computer Vision - 정리Note

## Chapter01 Introduction

### 1 왜 컴퓨터 비전인가?

시각은 오감 중에 가장 강력한 인지 기능으로 알려져 있다. <br>
컴퓨터비전은 컴퓨터를 이용하여 시각 기능을 갖는 기계 장치를 만드는 기술 분야.

컴퓨터비전 응용 분야

| 응용 사례               | 그림                                                                          |
| ----------------------- | ----------------------------------------------------------------------------- |
| 구글 자동차 (자율 주행) | <img src="/assets/image/Chapter01/구글자동차.jpg" width="200" height="150">   |
| 수술용 로봇 다빈치      | <img src="/assets/image/Chapter01/로봇다빈치.jpg" width="200" height="150">   |
| 화성 탐사선             | <img src="/assets/image/Chapter01/화성탐사선.jpg" width="200" height="150">   |
| 딸기 따는 로봇          | <img src="/assets/image/Chapter01/딸기따는로봇.jpg" width="200" height="150"> |
| 공항 검색대             | <img src="/assets/image/Chapter01/공항검색대.jpg" width="200" height="150">   |

- 얼굴인식은 응용이 아닌 문제에 대한 해결이다.

### 2 컴퓨터 비전 문제는 어떻게 해결하나?

1. 과학적 접근과 공학적 접근

- 목표1 : 사람의 시각에 맞먹는 인공 시각.<br>
  컴퓨터비전이 목표1를 달성하기 위해서는 필연적으로 인간의 시각이 어떻게 작동하는지 원리를 밝혀낸 다음, 컴퓨터로 모방. <br>
  이는 '**과학적인 접근**' 방법으로, 현재 뇌 과학의 주된 관심사 중 하나.
  Marr로 대표되는 초창기 연구자들이 취했던 방식이지만 크게 두 가지 어려움이 있다. 인간의 시각 과정을 완전히 밝혀내는 것은 현재 기술로는 불가능. 또한 인간의 지능을 구성하는 지식 표현, 학습, 추론, 창작 등에 해당하는 인공지능 문제가 모두 풀려야 가능. <br>
  컴퓨터비전이 어려운 본질적인 이유는 역문제라는 점. 입력 영상은 3차원 투영인데, 컴퓨터 비전은 2차원으로부터 3차원을 알아내는 과정이다. 불행히도 이러한 과정에서 물체까지의 거리와 같은 중요한 정보는 사라진다. 반면에 사람은 영상을 보면 필요한 3차원 정보를 매우 쉽게 추론해 낸다. 현재는 그런 추론 기능을 갖는 알고리즘은 없다.<br>
  어려움을 야기하는 또 다른 이유는 불량무 문제라는 점이다. 즉 문제의 답이 유일하지 않다. 또한, 영상 획득 과정에서 발생하는 여러 종류의 noise도 원인이다.
- 목표2 : 한정된 범위에서 특정한 임무를 달성하는 인공 시각.
  '**공학적인 접근**'으로 굳이 인간의 시각 처리 원리를 모방하지 않아도 얼마든지 주어진 문제를 푸는 알고리즘을 고안가능. 즉, 우회적으로 주어진 문제를 해결해야 한다.

문제를 이해하기 위해 깨달아야 하는 사실이 또 있다. 입력되는 영상은 숫자로 구성된 2차원 배열이다.

2. 계층적 처리 <br>
   <img src="/assets/image/Chapter01/계층적 처리.png" width="500" height="150"> <br>
   전처리 : 주로 영상처리(image processing)가 담당. 카메라로 획득한 원래 영상을 입력 받아 사용 목적에 맞게 적절하게 처리하여 보다 개선된 영상으로 처리. 예) noise 제거, 초점흐린 영상 개선 등 <br>
   특징 추출 : 영상에서 edge, 선분, 원, 코너, 텍스처 등의 특징을 추출하는 단계. 예를 들어, HOG 특징, SIFT나 SURF와 같은 지역 특징 <br>
   해석 : 응용 목적에 따라 크게 다르다. 예) 얼굴인식-분류, 의료-의심스러운 곳, 자율 주행 자동차 - 차량 주행 방향

3. 문제 해결 도구

- 자료구조와 알고리즘
- 수학 (선형대수, 미분학, 확률과 통계)
- 기계학습

### 3 시스템 설계

<img src="/assets/image/Chapter01/시스템설계.png" width="300" height="250"> <br>

1. 문제 이해 <br>
   주어진 문제에 대하 직관적이고 철자한 이해가 선행되어야 한다. 때떄로 자신이 제약 조건을 설정하고 문제 범위를 결정할 수 있는 상황을 만날 수 있다.
2. 데이터베이스 수집 <br>
   고품질의 데이터베이스를 확보한 후 진행해야 효과적이다. 수집한 샘플은 훈련set(학습시키는데 사용할 set), 테스트set(시스템을 평가하는 set). 시스템을 학습시키리면 샘플 영상에 적절한 label를 붙여줘야 한다.
   예를 들면, PASCAL VOC, ImageNet, MNIST 등 굳이 직접 수지집하지 않더라도 커뮤니티에서 수집한 데이터베이스를 공개한 경우가 많다.(표준 데이터베이스의 사용이 중요하다.
3. 알고리즘 설계와 구현

- 알고리즘 설계 <br>
  적절한 알고리즘을 찾을 때까지 다양한 알고리즘을 적용해 보는 휴리스틱한 방식을 사용.통찰략과 경험이 있다면 시행착오를 줄일 수 있다. 또한, 여러 알고리즘의 성능을 객관적으로 비교 분석하는 일이 좋은 알고리즘을 선별하는데 도움이 된다.
- 프로그래밍(구현) <br>
  OpenCV(C나 C++), Matlab

4. 성능 평가 <br>
   문제 및 요구 사항에 따라 아주 다양하기 떄문에, 자세한 설명은 생략.

### 4 인접 학문

- 영상처리 <br>
  noise 제거, 화질개선 등의 작업. 주로 전처리 과정
- 컴퓨터 그래픽스 <br>
  영상을 생성하거나 합성
- 컴퓨터 비전<br>
  영상을 입력 받아, 분석 및 해석하여 고급 묘사를 출력
- 패턴인식 <br>
  다양한 데이터를 패턴으로 간주하고 분석과 분류 작업을 수행.

### 5) 학습자원

- 도서 <br>
  - Richard Szeliski, Computer Vision: Algorithms and Applications, Springer
  - Milan Sonka, Vacalv Hlavac, and Roger Boyle, Image Processing, Analysis and Machine Vision, 3rd Edition, Thomson
  - Linda G. Shaprio and George C. Stockman, Computer Vision, Prentice Hall
  - 영상처리 [Gonzalez2010], 패턴인식[오일석2008]
- 학술지 및 학술 대회
  - IEEE(PAMI),CVPR, ICCV, IJCV 등
- 웹사이트
  - CVonline [here](http://homepages.inf.ed.ac.uk/rbf/CVonline)
  - VisionBib.Com [here](http://www.visionbib.com/bibliography/contents.html)
  - Computer Vision Online [here](http://www.computervisiononline.com)

## Chapter02 Image Processing

### 1 디지털 영상이란?

1. 디지털 영상의 태동 <br>
   디지털 영상의 응용은 신문 산업에서 태동. 1920년에 Bartlane이라는 케이블 영상 전송 시스템이 등장. 대략 한 세기 이후, 고해상도 사진을 찍어 바로 전송할 수 있을 뿐만 아니라 고품질 동영상을 실시간으로 방송할 수도 있게 되었다. 이런 상황에 발맞추어 `컴퓨터 비전과 인터넷의 교차점`에 초점을 맞춘 인터넷 비전이라는 새로운 연구 분야가 태동할 정도로 영상 처리와 컴퓨터 비전은 주목을 받고 있다.

2. 획득과 표현 <br>
   영상을 획득하는 장비인 카메라는 사람의 눈과 비슷한 구조를 가진다.

| 눈(eye) | 카메라        |
| ------- | ------------- |
| 수정체  | 렌즈          |
| 망막    | CCD센서(필름) |

망막에는 밝기에 반응하는 간상체와 색에 반응하는 추상체가 분포.

<img src="/assets/image/Chapter02/Pinhole-camera.png" width="300" height="250"> <br>
핀홀카메라 모델로, 카메라의 작당 원리를 단순하게 표현한 모델. <br>
입력영상을 샘플링(디지털 데이터로 추출)과 양자화(입력값을 매핑)한다. <br>
그 결과 숫자로 이루어진 디지털 영상(2차원의 벡터)으로 보여준다.

2차원 영상의 영상 좌표는 원점이 왼쪽 위에 위치한다. <br>
2차원 좌표를 x=(j,i),x=(y,x)로 표기하는데 j(y)는 수직방향, i(x)는 수평 방향 <br>
이러한 한 점을 화소(pixel)라 하고, 영상의 크기를 해상도(resolution)라 부른다. <br>
명암값의 범위는 0~255, 컬러영상은 한 화소에 R,G,B 값을 갖는다. <br>
좌표계에서 주의하는 것이 수학의 기하 단원에서 사용하는 (x,y) 대신 (y,x)를 사용한다는 점(수직방향 우선). 이유는 행렬이나 Matlab, OpenCV도 (y,x)를 사용하기 때문. 컴퓨터비전에서 다루는 영상은 모두 디지털 영상이다. 즉, 연속된 2차원 공간을 샘플링하여 정수 좌표를 갖는 j축과 i축을 구성. 명암은 [0,L-1] 범위의 L단계로 양자화한다.

## 2 히스토그램#

1. 히스토그램 계산
   히스토그램은 명암의 빈도수. 명암값이 영상에 몇번 나타나는지 표시하는 방식. <br>
   <img src="/assets/image/Chapter02/히스토그램.jpg" width="300" height="250"> <br>
   명암 영상에서 히스토그램 계산

```c++
// 1차원 명암 히스토그램 계산 알고리즘
// 초기화, 256은 L(명암 범위 길이)
for(i=0; i<256; i++){
  h[i] = 0;
}
// 히스토그램 증가
for(row=0; row<image.height(); row++){
  for(col=0; col<image.width(); col++){
    int pixel = image[row][col]; // 명암값
    h[pixel]++; // 해당 배열 index에 추가
  }
}

// 정규화
for(i=1; i<256; i++){
  norm_h[i] = h[i] / 총픽셀수(이미지 크기);
}
```

2. 히스토그램 용도

- 영상의 특성 파악 <br>
  예를 들어, 왼쪽으로 치우처져 있으면 어두운 영상, 오른쪽으로 치우처져 있으면 밝은 영상으로 파악 가능하다.
- 평활화(equalization)을 통한 영상 품질 개선. <br>
  다소 치우친 영상을 평평하게 만든다. 이로 인해, 명암의 범위(동적 범위)가 늘어나 영상이 선명해진다.

```c++
// 히스토그램 평활화 알고리즘
// 초기화, 256은 L(명암 범위 길이)
for(i=0; i<256; i++){
  h[i] = 0;
}
// 히스토그램 증가
for(row=0; row<image.height(); row++){
  for(col=0; col<image.width(); col++){
    int pixel = image[row][col]; // 명암값
    h[pixel]++; // 해당 배열 index에 추가
  }
}

// 정규화
acc_h[0] = h[0];
for(i=1; i<256; i++){
  acc_h[i] = acc_h[i-1]+h[i];
}

double scale = 최대 명암도 / 총픽셀수;
for(j=0; j<256; i++){
  norm_h[j] = acc_h=[j]*scale;
}

// 정규화된 히스토그램 분포값으로 변환
for(row=0; row<image.height(); row++){
  for(col=0; col<image.width(); col++){
    int pixel = image[row][col]; // 명암값
    image[row][col] = norm_h[pixel];
  }
}
```

히스토그램 평활화는 품질이 좋아지는 방식이지만, 때로는 예상 밖으로 품질이 떨어질 수도 있따. 이와 같이 상황과 목적에 따라 품질 개선이 달라질 수 있다.

3. 히스토그램 역투영과 얼굴 검출 <br>
   역투영(backprojection) : 물체의 모양은 무시하고 단순히 컬로분포만으로 검출하는 방법. 얼굴을 검출하려면 얼굴과 히스토그램이 필요. <br>
   이때 히스토그램은 명암채널만 이용하는 1차원이 아닌 최소 2차원을 사용해야 한다. 명암은 조명에 따라 쉽게 변할 뿐만 아니라 얼굴과 비슷한 명암을 갖는 다른 영역이 여러 군데 존재할 가능성이 높아, 명암만으로는 피부에 해당하는 영역을 구별하기 어려움. <br>
   따라서, RGB 색상 공간을 HSI(Hue:색상, Saturation:채도, Intensity:명암)공간으로 변환한 후, HS채널만 사용.

```c++
// 2차원 히스토그램 (HS공간)
// 초기화
for(i=0; i<256; i++){
  h[i][i] = 0;
}

// 기본적으로 1차원하고 비슷한데 h,s채널에 양자화를 한다.
```

```c++
// 역투영
// 새 영상의 h,s채널을 양자화하여, 2차원 히스토그램에 대입한다.
```

역투영한 결과는 예상한대로 얼굴에 큰 값을 가지낟. 하지만 손 영역도 큰 값을 가지는데, 손과 얼굴의 색이 비슷하기 때문. 따라서 컴퓨터 비전은 물체 검출 문제를 풀 때 모양 특징을 주로 사용하며, 상황에 따라 색 분포 정보를 보조로 사용. <br>

이러한 한계에도 히스토그램은 물체의 이동과 회전에 불변하다. 따라서 히스토그램 역투영은 물체가 이동하거나 회전해도 성능이 유지된다.

## 3 이진 영상(흑백)
